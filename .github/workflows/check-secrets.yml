name: Check Secrets

on:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check KEYSTORE secret
        run: |
          echo "检查 Secrets 配置..."
          echo ""
          
          if [ -z "${{ secrets.KEYSTORE }}" ]; then
            echo "❌ KEYSTORE 未设置"
            echo "请在 GitHub Settings > Secrets > Actions 中添加 KEYSTORE"
          else
            echo "✓ KEYSTORE 已设置 (长度: ${#KEYSTORE_VALUE})"
          fi
          
          if [ -z "${{ secrets.KEYSTORE_PASSWORD }}" ]; then
            echo "❌ KEYSTORE_PASSWORD 未设置"
          else
            echo "✓ KEYSTORE_PASSWORD 已设置"
          fi
          
          if [ -z "${{ secrets.KEY_ALIAS }}" ]; then
            echo "❌ KEY_ALIAS 未设置"
          else
            echo "✓ KEY_ALIAS 已设置: ${{ secrets.KEY_ALIAS }}"
          fi
          
          if [ -z "${{ secrets.KEY_PASSWORD }}" ]; then
            echo "❌ KEY_PASSWORD 未设置"
          else
            echo "✓ KEY_PASSWORD 已设置"
          fi
          
          echo ""
          echo "=== 检查完成 ==="
          
          # 如果所有 secrets 都设置了，尝试解码 keystore
          if [ ! -z "${{ secrets.KEYSTORE }}" ]; then
            echo ""
            echo "尝试解码 KEYSTORE..."
            echo "${{ secrets.KEYSTORE }}" | base64 -d > test.keystore 2>&1
            if [ $? -eq 0 ]; then
              echo "✓ KEYSTORE base64 解码成功"
              ls -lh test.keystore
            else
              echo "❌ KEYSTORE base64 解码失败 - 可能格式不正确"
            fi
          fi
        env:
          KEYSTORE_VALUE: ${{ secrets.KEYSTORE }}
